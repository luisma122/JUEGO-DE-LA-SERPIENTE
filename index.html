<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Snake Game Mejorado</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #a6e3ff, #d0ffea);
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
    }

    /* Paneles */
    #menu, #instructions, #gameOverWindow, #winWindow {
        position: absolute;
        background: white;
        padding: 25px;
        border-radius: 20px;
        box-shadow: 0 0 30px rgba(0,0,0,0.15);
        text-align: center;
        display: none;
        animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
        from { transform: scale(0.8); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }

    button {
        padding: 14px 25px;
        margin: 10px;
        border: none;
        border-radius: 10px;
        background: #48aaff;
        color: white;
        font-size: 18px;
        cursor: pointer;
        transition: 0.2s;
    }
    button:hover { background: #1f8ae0; }

    #scoreDisplay {
        position: absolute;
        top: 15px;
        left: 15px;
        font-size: 22px;
        color: #004466;
        font-weight: bold;
    }
</style>
</head>
<body>

<!-- Men√∫ -->
<div id="menu">
    <h1>üêç SNAKE GAME</h1>
    <button id="playBtn">Jugar</button>
    <button id="instBtn">Instrucciones</button>
</div>

<!-- Instrucciones -->
<div id="instructions">
    <h2>üìò Instrucciones</h2>
    <p>
        PC: Usa las flechas para moverte.<br>
        M√≥vil: Desliza o usa botones t√°ctiles.<br>
        Cada manzana = <b>10 puntos</b><br>
        Ganas al llegar a <b>200 puntos</b>.
    </p>
    <button id="backBtn">Volver</button>
</div>

<!-- Perdiste -->
<div id="gameOverWindow">
    <h2>üí• ¬°Perdiste!</h2>
    <p>Chocaste contra una pared o tu cuerpo.</p>
    <button onclick="resetGame()">Reiniciar</button>
    <button onclick="exitToMenu()">Salir</button>
</div>

<!-- Ganaste -->
<div id="winWindow">
    <h2>üéâ ¬°Felicidades!</h2>
    <p>¬°Llegaste a 200 puntos!</p>
    <button onclick="resetGame()">Reiniciar</button>
    <button onclick="exitToMenu()">Salir</button>
</div>

<div id="scoreDisplay">Puntaje: 0</div>

<canvas id="gameCanvas" width="400" height="400" style="display:none; background:#ddfff5; border-radius:10px;"></canvas>

<script>
let canvas = document.getElementById("gameCanvas");
let ctx = canvas.getContext("2d");
let box = 20;
let direction = "RIGHT";
let nextDirection = "RIGHT";
let snake = [];
let food;
let score = 0;
let gameInterval;

const TARGET_SCORE = 200;

/* Mostrar men√∫ */
document.getElementById("menu").style.display = "block";

document.getElementById("playBtn").onclick = startGame;
document.getElementById("instBtn").onclick = () => {
    document.getElementById("menu").style.display = "none";
    document.getElementById("instructions").style.display = "block";
};
document.getElementById("backBtn").onclick = () => {
    document.getElementById("instructions").style.display = "none";
    document.getElementById("menu").style.display = "block";
};

function startGame() {
    document.getElementById("menu").style.display = "none";

    canvas.style.display = "block";
    score = 0;
    updateScore();

    snake = [{x: 200, y: 200}];
    direction = "RIGHT";
    nextDirection = "RIGHT";

    placeFood();

    clearInterval(gameInterval);
    gameInterval = setInterval(gameLoop, 100);
}

function resetGame() {
    document.getElementById("gameOverWindow").style.display = "none";
    document.getElementById("winWindow").style.display = "none";
    startGame();
}

function exitToMenu() {
    location.reload();
}

/* Comida */
function placeFood() {
    food = {
        x: Math.floor(Math.random() * (canvas.width / box)) * box,
        y: Math.floor(Math.random() * (canvas.height / box)) * box
    };
}

function updateScore() {
    document.getElementById("scoreDisplay").innerText = "Puntaje: " + score;
}

/* Controles */
window.addEventListener('keydown', e => {
    if (["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)) e.preventDefault();

    function opposite(d, nd) {
        return (d === "LEFT" && nd === "RIGHT") ||
               (d === "RIGHT" && nd === "LEFT") ||
               (d === "UP" && nd === "DOWN") ||
               (d === "DOWN" && nd === "UP");
    }

    if (e.key === "ArrowLeft" && !opposite(direction, "LEFT")) nextDirection = "LEFT";
    if (e.key === "ArrowRight" && !opposite(direction, "RIGHT")) nextDirection = "RIGHT";
    if (e.key === "ArrowUp" && !opposite(direction, "UP")) nextDirection = "UP";
    if (e.key === "ArrowDown" && !opposite(direction, "DOWN")) nextDirection = "DOWN";
});

/* Dibujar serpiente */
function drawSnake() {
    snake.forEach((part, index) => {
        let grad = ctx.createLinearGradient(part.x, part.y, part.x + box, part.y + box);
        grad.addColorStop(0, index === 0 ? "#6aff6a" : "#b0ffb0");
        grad.addColorStop(1, index === 0 ? "#3de63d" : "#72e772");

        ctx.fillStyle = grad;
        ctx.fillRect(part.x, part.y, box - 1, box - 1);

        if (index === 0) {
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.arc(part.x + box * 0.25, part.y + box * 0.35, box * 0.12, 0, Math.PI * 2);
            ctx.arc(part.x + box * 0.75, part.y + box * 0.35, box * 0.12, 0, Math.PI * 2);
            ctx.fill();
        }
    });
}

/* Dibujar comida */
function drawFood() {
    let g = ctx.createRadialGradient(food.x+10, food.y+10, 2, food.x+10, food.y+10, 10);
    g.addColorStop(0, "#ff7777");
    g.addColorStop(1, "#cc0000");
    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(food.x+10, food.y+10, 10, 0, Math.PI * 2);
    ctx.fill();

    ctx.strokeStyle = "#228B22";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(food.x+10, food.y+3);
    ctx.lineTo(food.x+10, food.y-5);
    ctx.stroke();
}

/* Juego */
function gameLoop() {
    direction = nextDirection;

    let head = {x: snake[0].x, y: snake[0].y};
    if (direction === "LEFT") head.x -= box;
    if (direction === "RIGHT") head.x += box;
    if (direction === "UP") head.y -= box;
    if (direction === "DOWN") head.y += box;

    if (head.x < 0 || head.y < 0 || head.x >= canvas.width || head.y >= canvas.height) return lose();

    for (let i = 0; i < snake.length; i++) {
        if (head.x === snake[i].x && head.y === snake[i].y) return lose();
    }

    snake.unshift(head);

    /* Comer */
    if (head.x === food.x && head.y === food.y) {
        score += 10;
        updateScore();
        if (score >= TARGET_SCORE) return win();
        placeFood();
    } else {
        snake.pop();
    }

    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawFood();
    drawSnake();
}

/* Perder */
function lose() {
    clearInterval(gameInterval);
    document.getElementById("gameOverWindow").style.display = "block";
}

/* GANAR */
function win() {
    clearInterval(gameInterval);
    document.getElementById("winWindow").style.display = "block";
}
</script>

</body>
</html>
